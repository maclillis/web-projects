/*
 Tom Gallacher <http://www.tomg.co>
 @version 0.0.1a
 @license MIT License
 @options frequency, callback
*/
(function(p,m){"function"===typeof define&&define.amd?define(m):"object"===typeof exports?module.exports=m():p.gyro=m()})(this,function(){function p(a){var b=Math.PI/180,c=a.beta*b,h=a.gamma*b,n=a.alpha*b;a=Math.cos(c/2);var b=Math.cos(h/2),q=Math.cos(n/2),c=Math.sin(c/2),h=Math.sin(h/2),n=Math.sin(n/2);return{x:c*b*q-a*h*n,y:a*h*q+c*b*n,z:a*b*n+c*h*q,w:a*b*q-c*h*n}}function m(a,b){return{w:a.w*b.w-a.x*b.x-a.y*b.y-a.z*b.z,x:a.w*b.x+a.x*b.w+a.y*b.z-a.z*b.y,y:a.w*b.y-a.x*b.z+a.y*b.w+a.z*b.x,z:a.w*b.z+
a.x*b.y-a.y*b.x+a.z*b.w}}function t(a,b){a=m(b,{x:a.x,y:a.y,z:a.z,w:0});a=m(a,{w:b.w,x:-b.x,y:-b.y,z:-b.z});return{x:a.x,y:a.y,z:a.z}}var c={x:null,y:null,z:null,alpha:null,beta:null,gamma:null},g={x:0,y:0,z:0,alpha:0,beta:0,gamma:0,rawAlpha:0,rawBeta:0,rawGamma:0},r=null,k=[],l={frequency:500,calibrate:function(){for(var a in c)g[a]="number"===typeof c[a]?c[a]:0},getOrientation:function(){return c},startTracking:function(a){r=setInterval(function(){a(c)},l.frequency)},stopTracking:function(){clearInterval(r)},
hasFeature:function(a){for(var b in k)if(a==k[b])return!0;return!1},getFeatures:function(){return k}};l.eulerToQuaternion=p;window&&window.addEventListener&&function(){function a(b){k.push("MozOrientation");b.target.removeEventListener("MozOrientation",a,!0);b.target.addEventListener("MozOrientation",function(a){c.x=a.x-g.x;c.y=a.y-g.y;c.z=a.z-g.z},!0)}function b(a){k.push("devicemotion");a.target.removeEventListener("devicemotion",b,!0);a.target.addEventListener("devicemotion",function(a){c.x=a.accelerationIncludingGravity.x-
g.x;c.y=a.accelerationIncludingGravity.y-g.y;c.z=a.accelerationIncludingGravity.z-g.z},!0)}function l(a){k.push("deviceorientation");a.target.removeEventListener("deviceorientation",l,!0);a.target.addEventListener("deviceorientation",function(a){var b=p({alpha:g.rawAlpha,beta:g.rawBeta,gamma:g.rawGamma});b.x*=-1;b.y*=-1;b.z*=-1;var e=p({alpha:a.alpha,beta:a.beta,gamma:a.gamma}),f=m(b,e),b=180/Math.PI,d=t({x:0,y:1,z:0},f),e=0==d.x&&0==d.y?0:-Math.atan2(d.x,d.y),d=Math.atan2(d.z,Math.sqrt(d.x*d.x+d.y*
d.y)),h=Math.cos(e),k=Math.sin(e),l=Math.sin(e)*Math.sin(d),r=-Math.cos(e)*Math.sin(d),u=Math.cos(d),f=t({x:0,y:0,z:1},f),f=Math.atan2(f.x*h+f.y*k+0*f.z,f.x*l+f.y*r+f.z*u);0>e&&(e+=2*Math.PI);f>=.5*Math.PI?(f-=Math.PI,e+=Math.PI,d=0<d?Math.PI-d:-Math.PI-d):f<-.5*Math.PI&&(f+=Math.PI,e+=Math.PI,d=0<d?Math.PI-d:-Math.PI-d);e>=2*Math.PI&&(e-=2*Math.PI);c.alpha=e*b;c.beta=d*b;c.gamma=f*b;c.rawAlpha=a.alpha;c.rawBeta=a.beta;c.rawGamma=a.gamma},!0)}window.addEventListener("MozOrientation",a,!0);window.addEventListener("devicemotion",
b,!0);window.addEventListener("deviceorientation",l,!0)}();return l});
